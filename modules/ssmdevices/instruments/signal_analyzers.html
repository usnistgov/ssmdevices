<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ssmdevices.instruments.signal_analyzers &#8212; ssmdevices v0.11</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
<header class="nist-header">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>NIST Pages Template</title>
  <meta name="viewport" content="width=device-width">
  <meta name="description" content="ssmdevices v0.11">
  <link rel="canonical" href="../../../">
  <link rel="shortcut icon" href="/favicon.ico">

  <!-- Google Analytics -->
  <!--<script type="text/javascript" id="_fed_an_js_tag" src="http://www.nist.gov/js/federated-analytics.all.min.js?agency=NIST&subagency=mml&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c"></script> -->
  <!-- DAP Analytics -->
  <script type="text/javascript" id="_fed_an_ua_tag" src="https://dap.digitalgov.gov/Universal-Federated-Analytics-Min.js?agency=DOC&subagefncy=NIST&pua=UA-66610693-1&yt=true&exts=ppsx,pps,f90,sch,rtf,wrl,txz,m1v,xlsm,msi,xsd,f,tif,eps,mpg,xml,pl,xlt,c"></script>

  <!-- Custom CSS -->
  <link rel="stylesheet" href="../../..//static/NISTStyle.css">
  <link rel="stylesheet" href="../../..//static/NISTPages.css">

  <h1>
    <a class="nist-logo" target="_blank" href="http://www.nist.gov/" title="Go to nist.gov">National Institute of Standards and Technology</a>
  </h1>
  <div class="nist-links">
    <a class="nist-links-button" target="_blank" href="http://www.nist.gov">NIST Website</a>
    <a class="nist-links-button mobile-hide" target="_blank" href="http://www.nist.gov/public_affairs/nandyou.cfm">About NIST</a>
    <a class="nist-links-button mobile-hide" target="_blank" href="https://github.com/usnistgov">usnistgov on GitHub</a>
  </div>
  
  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</header>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../ssmdevices.html">ssmdevices v0.11</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ssmdevices.instruments.signal_analyzers</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for ssmdevices.instruments.signal_analyzers</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;RohdeSchwarzFSW26Base&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW26SpectrumAnalyzer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW26IQAnalyzer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW26LTEAnalyzer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW26RealTime&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW43Base&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW43SpectrumAnalyzer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW43IQAnalyzer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW43LTEAnalyzer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;RohdeSchwarzFSW43RealTime&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="kn">import</span> <span class="nn">labbench</span> <span class="k">as</span> <span class="nn">lb</span>

<span class="n">DEFAULT_CHANNEL_NAME</span> <span class="o">=</span> <span class="s2">&quot;remote&quot;</span>


<span class="k">class</span> <span class="nc">RohdeSchwarzFSWBase</span><span class="p">(</span><span class="n">lb</span><span class="o">.</span><span class="n">VISADevice</span><span class="p">):</span>
    <span class="n">_BOOL_LABELS</span> <span class="o">=</span> <span class="p">{</span><span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}</span>
    <span class="n">_DATA_FORMATS</span> <span class="o">=</span> <span class="s2">&quot;ASC,0&quot;</span><span class="p">,</span> <span class="s2">&quot;REAL,32&quot;</span><span class="p">,</span> <span class="s2">&quot;REAL,64&quot;</span><span class="p">,</span> <span class="s2">&quot;REAL,16&quot;</span>
    <span class="n">_CHANNEL_TYPES</span> <span class="o">=</span> <span class="s2">&quot;SAN&quot;</span><span class="p">,</span> <span class="s2">&quot;IQ&quot;</span><span class="p">,</span> <span class="s2">&quot;RTIM&quot;</span><span class="p">,</span> <span class="n">DEFAULT_CHANNEL_NAME</span>
    <span class="n">_TRIGGER_OUT_TYPES</span> <span class="o">=</span> <span class="s2">&quot;DEV&quot;</span><span class="p">,</span> <span class="s2">&quot;TARM&quot;</span><span class="p">,</span> <span class="s2">&quot;UDEF&quot;</span>
    <span class="n">_TRIGGER_DIRECTIONS</span> <span class="o">=</span> <span class="s2">&quot;INP&quot;</span><span class="p">,</span> <span class="s2">&quot;OUTP&quot;</span>
    <span class="n">_CHANNEL_TYPES</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;SAN&quot;</span><span class="p">,</span> <span class="s2">&quot;IQ&quot;</span><span class="p">,</span> <span class="s2">&quot;RTIM&quot;</span>
    <span class="n">_CACHE_DIR</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;c:\temp\remote-cache&quot;</span>

    <span class="n">expected_channel_type</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">allow_none</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">only</span><span class="o">=</span><span class="n">_CHANNEL_TYPES</span><span class="p">,</span>
        <span class="n">sets</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;which channel type to use&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">default_window</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;data window number to use if unspecified&quot;</span>
    <span class="p">)</span>
    <span class="n">default_trace</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;data trace number to use if unspecified&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Set these in subclasses for specific FSW instruments</span>
    <span class="n">frequency_center</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">frequency_span</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">frequency_start</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">frequency_stop</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">resolution_bandwidth</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">sweep_time</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;SWE:TIME&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>
    <span class="n">sweep_time_window2</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;SENS2:SWE:TIME&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span>

    <span class="n">initiate_continuous</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;INIT:CONT&quot;</span><span class="p">,</span> <span class="n">remap</span><span class="o">=</span><span class="n">_BOOL_LABELS</span><span class="p">)</span>

    <span class="n">reference_level</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC1:Y:RLEV&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span><span class="p">)</span>
    <span class="n">reference_level_trace2</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC2:Y:RLEV&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">reference_level_trace3</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC3:Y:RLEV&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">reference_level_trace4</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC4:Y:RLEV&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">reference_level_trace5</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC5:Y:RLEV&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">reference_level_trace6</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC6:Y:RLEV&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>

    <span class="n">amplitude_offset</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC1:Y:RLEV:OFFS&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">amplitude_offset_trace2</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC2:Y:RLEV:OFFS&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">amplitude_offset_trace3</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC3:Y:RLEV:OFFS&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">amplitude_offset_trace4</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC4:Y:RLEV:OFFS&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">amplitude_offset_trace5</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC5:Y:RLEV:OFFS&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>
    <span class="n">amplitude_offset_trace6</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;DISP:TRAC6:Y:RLEV:OFFS&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;dB&quot;</span>
    <span class="p">)</span>

    <span class="n">output_trigger2_direction</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;OUTP:TRIG2:DIR&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_TRIGGER_DIRECTIONS</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">output_trigger3_direction</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;OUTP:TRIG3:DIR&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_TRIGGER_DIRECTIONS</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">output_trigger2_type</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;OUTP:TRIG2:OTYP&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_TRIGGER_OUT_TYPES</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">output_trigger3_type</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;OUTP:TRIG3:OTYP&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_TRIGGER_OUT_TYPES</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">input_preamplifier_enabled</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;INP:GAIN:STATE&quot;</span><span class="p">,</span> <span class="n">remap</span><span class="o">=</span><span class="n">_BOOL_LABELS</span>
    <span class="p">)</span>
    <span class="n">input_attenuation_auto</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;INP:ATT:AUTO&quot;</span><span class="p">,</span> <span class="n">remap</span><span class="o">=</span><span class="n">_BOOL_LABELS</span><span class="p">)</span>
    <span class="n">input_attenuation</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;INP:ATT&quot;</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">79</span><span class="p">)</span>

    <span class="n">channel_type</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;INST&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_CHANNEL_TYPES</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;FORM&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_DATA_FORMATS</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">sweep_points</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;SWE:POIN&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100001</span><span class="p">)</span>

    <span class="n">display_update</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;SYST:DISP:UPD&quot;</span><span class="p">,</span> <span class="n">remap</span><span class="o">=</span><span class="p">{</span><span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;OFF&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;ON&quot;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">verify_channel_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_channel_type</span><span class="p">,</span> <span class="n">DEFAULT_CHANNEL_NAME</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_channel_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;expected </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_channel_type</span><span class="si">}</span><span class="s2"> mode, but got </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_type</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__imports__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">pd</span>
        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__imports__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># self.verify_channel_type()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;REAL,32&quot;</span>

    <span class="k">def</span> <span class="nf">acquire_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">acquisition_time_sec</span><span class="p">):</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">specs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">time_remaining</span> <span class="o">=</span> <span class="n">acquisition_time_sec</span>
        <span class="n">active_time</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1">#        while time_remaining&gt;0:</span>
        <span class="k">while</span> <span class="n">active_time</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Setup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_spectrogram</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="c1"># Give the power sensor time to arm</span>
            <span class="n">lb</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

            <span class="n">t0_active</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="c1"># Try to trigger; block until timeout.</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="n">time_remaining</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trigger_single</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">active_time</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0_active</span>
            <span class="c1">#             self.abort()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">50000</span>
            <span class="n">single</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_spectrogram</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="s2">&quot;fast&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">1000</span>

            <span class="k">if</span> <span class="n">single</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single</span><span class="p">)</span>

            <span class="n">time_remaining</span> <span class="o">=</span> <span class="n">acquisition_time_sec</span> <span class="o">-</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

        <span class="n">specs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">specs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">specs</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;sa_spectrogram&quot;</span><span class="p">:</span> <span class="n">specs</span><span class="p">,</span>
            <span class="s2">&quot;sa_spectrogram_acquisition_time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span>
            <span class="s2">&quot;sa_spectrogram_active_time&quot;</span><span class="p">:</span> <span class="n">active_time</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_status</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">clear_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*CLS&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">status_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;STAT:PRES&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">basedir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save current state of the device to the default directory.</span>
<span class="sd">        :param path: state file location on the instrument</span>
<span class="sd">        :type path: string</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">basedir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">basedir</span><span class="p">)</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">basedir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MMEMory:STORe:STATe 1,&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">basedir</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a previously saved state file in the instrument</span>

<span class="sd">        :param path: state file location on the instrument</span>
<span class="sd">        :type path: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">basedir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">basedir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">name</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.dfl&quot;</span><span class="p">):</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;.dfl&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_info</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;there is no file to load on the instrument at path &quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MMEM:LOAD:STAT 1,&#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cache_name</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">hash_caller</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_state</span><span class="p">(</span><span class="n">cache_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CACHE_DIR</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Successfully loaded cached save file&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">save_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cache_name</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">hash_caller</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_state</span><span class="p">(</span><span class="n">cache_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CACHE_DIR</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mkdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make a new directory (optionally recursively) on the instrument</span>
<span class="sd">        if we haven&#39;t tried to make it already.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prev_dirs</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prev_dirs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">recursive</span><span class="p">:</span>
            <span class="n">subs</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">subs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subs</span><span class="p">[:</span><span class="n">i</span><span class="p">]),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MMEM:MDIR &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__prev_dirs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">file_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_timeout</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MMEM:CAT? &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">remove_window</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LAY:REM &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trigger_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">disable_continuous</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger once.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">disable_continuous</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initiate_continuous</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;INIT&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">autolevel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Try to automatically set the reference level on the instrument, which sets the</span>
<span class="sd">        internal attenuation and preamplifier enable settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ADJ:LEV&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ABORT&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_channel_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup a channel with name DEFAULT_CHANNEL_NAME, that has measurement type self.channel_type</span>

<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">channel_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;INST:LIST?&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">DEFAULT_CHANNEL_NAME</span> <span class="ow">in</span> <span class="n">channel_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;INST:CRE:REPL &#39;</span><span class="si">{</span><span class="n">DEFAULT_CHANNEL_NAME</span><span class="si">}</span><span class="s2">&#39;,&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_type</span><span class="si">}</span><span class="s2">,&#39;</span><span class="si">{</span><span class="n">DEFAULT_CHANNEL_NAME</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;INST:CRE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_type</span><span class="si">}</span><span class="s2">,&#39;</span><span class="si">{</span><span class="n">DEFAULT_CHANNEL_NAME</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">channel_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SYST:PRES:CHAN&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">query_ieee_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An alternative to self.backend.query_binary_values for fetching block data. This</span>
<span class="sd">        implementation works around slowness between pyvisa and the instrument that seems to</span>
<span class="sd">        result from transferring in chunks of size self.backend.chunk_size as implemented</span>
<span class="sd">        in pyvisa.</span>

<span class="sd">        The performance of a transfer of a spectrogram with 100,000 time samples is impacted as follows:</span>

<span class="sd">        # The pyvisa implementation</span>
<span class="sd">        &gt;&gt;&gt;  %timeit -n 1 -r 1 sa.backend.query_binary_values(&#39;TRAC2:DATA? SPEC&#39;, container=np.array)</span>
<span class="sd">        (takes at least 10 minutes)</span>

<span class="sd">        # This implementation</span>
<span class="sd">        &gt;&gt;&gt; %timeit -n 1 -r 1 sa.query_ieee_array(&#39;TRAC2:DATA? SPEC&#39;)</span>
<span class="sd">        (~23 sec)</span>

<span class="sd">        :param msg: The SCPI command to send</span>
<span class="sd">        :return: a numpy array containing the response.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">from</span> <span class="nn">pyvisa.constants</span> <span class="kn">import</span> <span class="n">VI_SUCCESS_DEV_NPRESENT</span><span class="p">,</span> <span class="n">VI_SUCCESS_MAX_CNT</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;query </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># The read_termination seems to cause unwanted behavior in self.backend.visalib.read</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">read_termination</span><span class="p">,</span> <span class="n">old_read_term</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">read_termination</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">ignore_warning</span><span class="p">(</span>
                <span class="n">VI_SUCCESS_DEV_NPRESENT</span><span class="p">,</span> <span class="n">VI_SUCCESS_MAX_CNT</span>
            <span class="p">):</span>
                <span class="c1"># Reproduce the behavior of pyvisa.util.from_ieee_block without</span>
                <span class="c1"># a priori access to the entire buffer.</span>
                <span class="n">raw</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">visalib</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">digits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">raw</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">visalib</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">digits</span><span class="p">)</span>
                <span class="n">data_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">))</span>

                <span class="c1"># Read the actual data</span>
                <span class="n">raw</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">visalib</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">data_size</span><span class="p">)</span>

                <span class="c1"># Read termination characters so that the instrument doesn&#39;t show</span>
                <span class="c1"># a &quot;QUERY INTERRUPTED&quot; error when there is unread buffer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">visalib</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">old_read_term</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">read_termination</span> <span class="o">=</span> <span class="n">old_read_term</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;      -&gt; </span><span class="si">{}</span><span class="s2"> bytes (</span><span class="si">{}</span><span class="s2"> values)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_size</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">fetch_horizontal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_trace</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_ieee_array</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DATA:X? TRACE</span><span class="si">{</span><span class="n">trace</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch trace data with &#39;TRAC:DATA TRACE?&#39; and return the result in</span>
<span class="sd">        a pandas series.fetch and return the current trace data. This does not</span>
<span class="sd">        initiate a trigger; this must be done separately if desired.</span>
<span class="sd">        (see :method:`trigger_single`). This method is meant to be used</span>
<span class="sd">        in all signal analyzer modes (spectrum analyzer, IQ analyzer, LTE analyzer,</span>
<span class="sd">        etc.), because variants of TRAC:DATA TRACE? are implemented for each.</span>

<span class="sd">        The `trace` and `window` parameters have different meaning in different</span>
<span class="sd">        modes. Specify `window` only in signal analyzer modes that support it,</span>
<span class="sd">        which include LTE.  When `window` is not supported, specifying it (any</span>
<span class="sd">        value besides `None`) will cause a timeout.</span>

<span class="sd">        Trace data is returned in single-precision (32-bit) binary blocks.</span>

<span class="sd">        If necessary, we can read the count, set count to 1, read, adjust level</span>
<span class="sd">        then set the count back, and read again like this:</span>

<span class="sd">        ::</span>
<span class="sd">            count = inst.query(&quot;SENSE:SWEEP:COUNT?&quot;)</span>
<span class="sd">            self.write(&quot;SENSE:SWEEP:COUNT 1&quot;)</span>

<span class="sd">        :param trace: The trace number to query (or None, the default, to use self.default_trace)</span>
<span class="sd">        :param horizontal: Set the index of the returned Series by a call to :method:`fetch_horizontal`</span>
<span class="sd">        :param window: The window number to query (or None, the default, to use self.default_window)</span>
<span class="sd">        :return: a pd.Series object containing the returned data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">trace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_trace</span>
        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="n">horizontal</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trace</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">horizontal</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_horizontal</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_ieee_array</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DATA? TRACE</span><span class="si">{</span><span class="n">trace</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Trace &quot;</span> <span class="o">+</span> <span class="n">trace</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_ieee_array</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DATA? TRACE</span><span class="si">{</span><span class="n">trace</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_timestamps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">50000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch data timestamps associated with acquired data. Not all types of acquired data support timestamping,</span>
<span class="sd">        and not all modes support the trace argument. A choice that is incompatible with the current state</span>
<span class="sd">        of the signal analyzer should lead to a TimeoutError.</span>

<span class="sd">        :param all: If True, acquire and return all available timestamps; if False, only the most current timestamp.</span>
<span class="sd">        :param window: The window number corresponding to the desired timestamp data (or self.default_window when window=None)</span>
<span class="sd">        :return: A number (when `all` is False) or a np.array (when `all` is True)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>

        <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
            <span class="n">_to</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="n">timeout</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="s2">&quot;ALL&quot;</span> <span class="k">if</span> <span class="nb">all</span> <span class="k">else</span> <span class="s2">&quot;CURR&quot;</span>
            <span class="n">timestamps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">query_ascii_values</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:SGR:TST:DATA? </span><span class="si">{</span><span class="n">scope</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span>
            <span class="p">)</span>
            <span class="n">timestamps</span> <span class="o">=</span> <span class="n">timestamps</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">timestamps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">))[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="n">timestamps</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-9</span> <span class="o">*</span> <span class="n">timestamps</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">_to</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

    <span class="k">def</span> <span class="nf">fetch_spectrogram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">freqs</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a spectrogram without initiating a new trigger. This has been tested in IQ Analyzer and real time</span>
<span class="sd">        spectrum analyzer modes. Not all instrument operating modes support trace selection; a choice that is</span>
<span class="sd">        incompatible with the current state of the signal analyzer should lead to a TimeoutError.</span>

<span class="sd">        :param freqs: &#39;exact&#39; (to fetch the frequency axis), &#39;fast&#39; (to guess at index values based on FFT parameters), or None (leaving the integer indices)</span>
<span class="sd">        :param timestamps: &#39;exact&#39; (to fetch the frequency axis), &#39;fast&#39; (to guess at index values based on sweep time), or None (leaving the integer indices)</span>
<span class="sd">        :param window: The window number corresponding to the desired timestamp data (or self.default_window when window=None)</span>
<span class="sd">        :return: a pandas DataFrame containing the acquired data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;mask&quot;</span><span class="p">:</span>
                <span class="n">max_trigger_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_post_time</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_trigger_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_dwell_time</span>

            <span class="n">old_timeout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span>
                <span class="mi">6</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">max_trigger_time</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">old_timeout</span> <span class="o">=</span> <span class="n">timeout</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_timeout</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_ieee_array</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DATA? SPEC&quot;</span><span class="p">)</span>

            <span class="c1"># Fetch time axis</span>
            <span class="k">if</span> <span class="n">timestamps</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;fast&quot;</span><span class="p">,</span> <span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;timestamps argument must be &#39;fast&#39;, &#39;exact&#39;, or None&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">timestamps</span> <span class="o">==</span> <span class="s2">&quot;exact&quot;</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_timestamps</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">timestamps</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="c1"># Fetch frequency axis</span>
            <span class="k">if</span> <span class="n">freqs</span> <span class="o">==</span> <span class="s2">&quot;fast&quot;</span><span class="p">:</span>
                <span class="n">fc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">frequency_center</span>
                <span class="n">fsamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iq_sample_rate</span>
                <span class="n">Nfreqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_points</span>
                <span class="n">f_</span> <span class="o">=</span> <span class="n">fc</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
                    <span class="o">-</span><span class="n">fsamp</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">Nfreqs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="o">+</span><span class="n">fsamp</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">Nfreqs</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                    <span class="n">Nfreqs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="n">freqs</span> <span class="o">==</span> <span class="s2">&quot;exact&quot;</span><span class="p">:</span>
                <span class="n">f_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_horizontal</span><span class="p">(</span><span class="n">window</span><span class="p">)</span>
                <span class="n">Nfreqs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f_</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">freqs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">f_</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">Nfreqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_points</span>

            <span class="c1"># Reshape data according to frequency axis, since we&#39;ll be most certain</span>
            <span class="c1"># to know that dimension</span>
            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="n">Nfreqs</span><span class="p">,</span> <span class="n">Nfreqs</span><span class="p">))</span>

            <span class="c1"># Generate timestamps if we&#39;re going to guesstimate</span>
            <span class="k">if</span> <span class="n">timestamps</span> <span class="o">==</span> <span class="s2">&quot;fast&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">window</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">sweep_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_time</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sweep_time</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;sweep_time_window&quot;</span> <span class="o">+</span> <span class="n">window</span><span class="p">)</span>
                <span class="n">ts0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_timestamps</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">ts0</span> <span class="o">-</span> <span class="n">sweep_time</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">sweep_time</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">old_timeout</span>

            <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">f_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span> <span class="k">if</span> <span class="n">t</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">t</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([],</span> <span class="n">columns</span><span class="o">=</span><span class="n">f_</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">old_timeout</span>

        <span class="c1"># If there is a timeout, the return above will not happen.</span>
        <span class="c1"># In this case, abort the acquisition and return</span>
        <span class="c1"># None.</span>
        <span class="c1"># self._logger.warning(&#39;received no spectrogram data&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="c1"># self.clear_status()</span>
        <span class="c1"># self.wait()</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">fetch_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marker value</span>

<span class="sd">        :param marker: marker number on instrument display</span>
<span class="sd">        :type marker: int</span>
<span class="sd">        :param axis: &#39;X&#39; for x axis or &#39;Y&#39; for y axis</span>
<span class="sd">        :type axis: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_marker_enables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">markers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
        <span class="n">states</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">:STATE?&quot;</span><span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">m</span><span class="si">}</span><span class="s2">:FUNC:BPOW:STATE?&quot;</span><span class="p">),</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">markers</span>
        <span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">states</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Marker&quot;</span><span class="p">,</span> <span class="s2">&quot;Band&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">markers</span><span class="p">)</span>

        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Marker&quot;</span>

        <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_marker_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marker value (on vertical axis)</span>

<span class="sd">        :param marker: marker number on instrument display</span>

<span class="sd">        :type marker: int</span>

<span class="sd">        :param axis: &#39;X&#39; for x axis or &#39;Y&#39; for y axis</span>

<span class="sd">        :type axis: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2">:Y?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_marker_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marker position (on horizontal axis)</span>

<span class="sd">        Arguments:</span>
<span class="sd">            marker: marker number on instrument display</span>

<span class="sd">        Returns:</span>
<span class="sd">            position of the marker, in units of the horizontal axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2">:X?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_marker_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">position</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marker position (on horizontal axis)</span>

<span class="sd">        Arguments:</span>
<span class="sd">            marker: marker number on instrument display</span>
<span class="sd">            position: position of the marker, in units of the horizontal axis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2">:X </span><span class="si">{</span><span class="n">position</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">trigger_output_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param port: Trigger port number</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;OUTPUT:TRIGGER</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s2">:PULS:IMM&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RohdeSchwarzSpectrumAnalyzerMixIn</span><span class="p">(</span>
    <span class="n">RohdeSchwarzFSWBase</span><span class="p">,</span> <span class="n">expected_channel_type</span><span class="o">=</span><span class="s2">&quot;SAN&quot;</span>
<span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_marker_band_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marker band power measurement</span>

<span class="sd">        Arguments:</span>
<span class="sd">            marker: marker number on instrument display</span>

<span class="sd">        Returns:</span>
<span class="sd">            power in dBm</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2">:FUNC:BPOW:RES?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_marker_band_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get span of marker band power measurement</span>

<span class="sd">        Arguments:</span>
<span class="sd">            marker: marker number on instrument display</span>

<span class="sd">        Returns:</span>
<span class="sd">            bandwidth in Hz</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2">:FUNC:BPOW:SPAN?&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_marker_power_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the values of all markers.&quot;&quot;&quot;</span>
        <span class="n">enables</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker_enables</span><span class="p">()</span>

        <span class="n">values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Frequency&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">enables</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">enables</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
            <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">enables</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">enables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Marker&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Marker&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker_power</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
                <span class="n">values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Frequency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker_position</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">enables</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Band&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">values</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;Band&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_marker_band_power</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

        <span class="n">values</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="k">def</span> <span class="nf">fetch_marker_bpow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marker band power measurement</span>

<span class="sd">        :param marker: marker number on instrument display</span>

<span class="sd">        :type marker: int</span>

<span class="sd">        :return: power in dBm</span>

<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mark_cmd</span> <span class="o">=</span> <span class="s2">&quot;CALC:MARK&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">marker</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:FUNC:BPOW:RES?&quot;</span>
        <span class="n">marker_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">mark_cmd</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">marker_val</span>

    <span class="k">def</span> <span class="nf">fetch_marker_bpow_span</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">marker</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get marker band power measurement</span>

<span class="sd">        :param marker: marker number on instrument display</span>

<span class="sd">        :type marker: int</span>

<span class="sd">        :return: bandwidth</span>

<span class="sd">        :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC:MARK</span><span class="si">{</span><span class="n">marker</span><span class="si">}</span><span class="s2">:FUNC:BPOW:SPAN?&quot;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">RohdeSchwarzLTEAnalyzerMixIn</span><span class="p">(</span><span class="n">RohdeSchwarzFSWBase</span><span class="p">):</span>
    <span class="nb">format</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;FORM&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;REAL&quot;</span><span class="p">,</span> <span class="s2">&quot;ASCII&quot;</span><span class="p">),</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">uplink_sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CONF:LTE:UL:BW?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e6</span>

    <span class="nd">@lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">downlink_sample_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;CONF:LTE:DL:BW?&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1e6</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lb</span><span class="o">.</span><span class="n">VISADevice</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># self.verify_channel_type()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s2">&quot;REAL&quot;</span>

    <span class="k">def</span> <span class="nf">fetch_power_vs_symbol_x_carrier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">)</span>

        <span class="c1"># Dimensioning is based on LTE standard definitions</span>
        <span class="c1"># of the resource block</span>
        <span class="n">Ncarrier</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">50</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">uplink_sample_rate</span> <span class="o">/</span> <span class="mf">10e6</span><span class="p">)</span>
        <span class="n">Nsubcarrier</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">*</span> <span class="n">Ncarrier</span>
        <span class="n">Nsymbol</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="n">Nsubcarrier</span>

        <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="mf">1e30</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">Nsymbol</span><span class="p">,</span> <span class="n">Nsubcarrier</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Symbol&quot;</span>
        <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Subcarrier&quot;</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="c1"># The methods should be deprecatable now, since the base fetch_trace() should work fine now that format is set</span>
    <span class="c1"># in the connect() method and the window parameter is supported by fetch_trace()</span>
    <span class="k">def</span> <span class="nf">get_ascii_window_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FORM ASCII&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">query_ascii_values</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DATA? TRACE</span><span class="si">{</span><span class="n">trace</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_binary_window_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">trace</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FORM REAL&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">query_binary_values</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DATA? TRACE</span><span class="si">{</span><span class="n">trace</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;f&quot;</span><span class="p">,</span>
            <span class="n">is_big_endian</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">container</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="k">def</span> <span class="nf">get_allocation_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;FORM ASCII&quot;</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DATA? TRACE1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data</span>


<span class="k">class</span> <span class="nc">RohdeSchwarzIQAnalyzerMixIn</span><span class="p">(</span><span class="n">RohdeSchwarzFSWBase</span><span class="p">,</span> <span class="n">expected_channel_type</span><span class="o">=</span><span class="s2">&quot;RTIM&quot;</span><span class="p">):</span>
    <span class="n">_IQ_FORMATS</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;FREQ&quot;</span><span class="p">,</span> <span class="s2">&quot;MAGN&quot;</span><span class="p">,</span> <span class="s2">&quot;MTAB&quot;</span><span class="p">,</span> <span class="s2">&quot;PEAK&quot;</span><span class="p">,</span> <span class="s2">&quot;RIM&quot;</span><span class="p">,</span> <span class="s2">&quot;VECT&quot;</span><span class="p">)</span>
    <span class="n">_IQ_MODES</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;TDOMain&quot;</span><span class="p">,</span> <span class="s2">&quot;FDOMain&quot;</span><span class="p">,</span> <span class="s2">&quot;IQ&quot;</span><span class="p">)</span>

    <span class="n">iq_simple_enabled</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;CALC:IQ&quot;</span><span class="p">,</span> <span class="n">remap</span><span class="o">=</span><span class="p">{</span><span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;OFF&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;ON&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">iq_evaluation_enabled</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;CALC:IQ:EVAL&quot;</span><span class="p">,</span> <span class="n">remap</span><span class="o">=</span><span class="p">{</span><span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;OFF&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;ON&quot;</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">iq_mode</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;CALC:IQ:MODE&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_IQ_MODES</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">iq_record_length</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRAC:IQ:RLEN&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">461373440</span><span class="p">)</span>
    <span class="n">iq_sample_rate</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRAC:IQ:SRAT&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">160e6</span><span class="p">)</span>
    <span class="n">iq_format</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;CALC:FORM&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_IQ_FORMATS</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">iq_format_window2</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;CALC2:FORM&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">_IQ_FORMATS</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iq_format</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;VECT&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">RohdeSchwarzFSWBase</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">RohdeSchwarzFSWBase</span><span class="o">.</span><span class="n">fetch_trace</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">horizontal</span><span class="o">=</span><span class="n">horizontal</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="n">trace</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;RIM&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;columns&quot;</span><span class="p">):</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span>
                    <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
                    <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">],</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s2">&quot;VECT&quot;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>

    <span class="k">def</span> <span class="nf">store_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MMEM:STOR:IQ:STAT 1, &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RohdeSchwarzRealTimeMixIn</span><span class="p">(</span><span class="n">RohdeSchwarzFSWBase</span><span class="p">,</span> <span class="n">expected_channel_type</span><span class="o">=</span><span class="s2">&quot;RTIM&quot;</span><span class="p">):</span>
    <span class="n">TRIGGER_SOURCES</span> <span class="o">=</span> <span class="s2">&quot;IMM&quot;</span><span class="p">,</span> <span class="s2">&quot;EXT&quot;</span><span class="p">,</span> <span class="s2">&quot;EXT2&quot;</span><span class="p">,</span> <span class="s2">&quot;EXT3&quot;</span><span class="p">,</span> <span class="s2">&quot;MASK&quot;</span><span class="p">,</span> <span class="s2">&quot;TDTR&quot;</span>
    <span class="n">WINDOW_FUNCTIONS</span> <span class="o">=</span> <span class="s2">&quot;BLAC&quot;</span><span class="p">,</span> <span class="s2">&quot;FLAT&quot;</span><span class="p">,</span> <span class="s2">&quot;GAUS&quot;</span><span class="p">,</span> <span class="s2">&quot;HAMM&quot;</span><span class="p">,</span> <span class="s2">&quot;HANN&quot;</span><span class="p">,</span> <span class="s2">&quot;KAIS&quot;</span><span class="p">,</span> <span class="s2">&quot;RECT&quot;</span>
    <span class="n">_BOOL_LABELS</span> <span class="o">=</span> <span class="p">{</span><span class="kc">False</span><span class="p">:</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">:</span> <span class="s2">&quot;1&quot;</span><span class="p">}</span>

    <span class="n">trigger_source</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRIG:SOUR&quot;</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">TRIGGER_SOURCES</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">trigger_post_time</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRIG:POST&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">trigger_pre_time</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRIG:PRET&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">iq_fft_length</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;IQ:FFT:LENG&quot;</span><span class="p">,</span> <span class="n">sets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">iq_bandwidth</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRAC:IQ:BWID&quot;</span><span class="p">,</span> <span class="n">sets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">iq_sample_rate</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRACe:IQ:SRAT&quot;</span><span class="p">,</span> <span class="n">sets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">iq_trigger_position</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;TRAC:IQ:TPIS&quot;</span><span class="p">,</span> <span class="n">sets</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">sweep_dwell_auto</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">bool</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;SWE:DTIM:AUTO&quot;</span><span class="p">,</span> <span class="n">remap</span><span class="o">=</span><span class="n">_BOOL_LABELS</span><span class="p">)</span>
    <span class="n">sweep_dwell_time</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;SWE:DTIM&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">30e-3</span><span class="p">)</span>
    <span class="n">sweep_window_type</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">str</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;SWE:FFT:WIND:TYP&quot;</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">only</span><span class="o">=</span><span class="n">WINDOW_FUNCTIONS</span>
    <span class="p">)</span>

    <span class="c1">#    def fetch_trace(self, horizontal=False):</span>
    <span class="c1">#        fmt = self.iq_format</span>
    <span class="c1">#        if fmt == &#39;VECT&#39;:</span>
    <span class="c1">#            df = RohdeSchwarzFSW26Base.fetch_trace(self,1,False)</span>
    <span class="c1">#        else:</span>
    <span class="c1">#            df = RohdeSchwarzFSW26Base.fetch_trace(self,1,horizontal)</span>
    <span class="c1">#</span>
    <span class="c1">#        if fmt == &#39;RIM&#39;:</span>
    <span class="c1">#            if hasattr(df,&#39;columns&#39;):</span>
    <span class="c1">#                df = pd.DataFrame(df.iloc[:len(df)//2].values+1j*df.iloc[len(df)//2:].values,</span>
    <span class="c1">#                                  index=df.index[:len(df)//2],</span>
    <span class="c1">#                                  columns=df.columns)</span>
    <span class="c1">#            else:</span>
    <span class="c1">#                df = pd.Series(df.iloc[:len(df)//2].values+1j*df.iloc[len(df)//2:].values,</span>
    <span class="c1">#                                  index=df.index[:len(df)//2])</span>
    <span class="c1">#        if fmt == &#39;VECT&#39;:</span>
    <span class="c1">#            df = pd.DataFrame(df.iloc[1::2].values,index=df.iloc[::2].values)</span>
    <span class="c1">#</span>
    <span class="c1">#        return df</span>

    <span class="k">def</span> <span class="nf">store_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MMEM:STOR</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:SGR &#39;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:SGR:CLE&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_horizontal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">query_binary_values</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;TRAC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:X? TRACE</span><span class="si">{</span><span class="n">trace</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">container</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_detector_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_trace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WIND</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:DET</span><span class="si">{</span><span class="n">trace</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">type_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_detector_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>
        <span class="k">if</span> <span class="n">trace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">trace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_trace</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;WIND</span><span class="si">{window}</span><span class="s2">:DET</span><span class="si">{trace}</span><span class="s2">?&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_spectrogram_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:SPEC:HDEP </span><span class="si">{</span><span class="n">depth</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@lb</span><span class="o">.</span><span class="n">datareturn</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">781</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">100000</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_spectrogram_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:SPEC:HDEP?&quot;</span><span class="p">)</span>

    <span class="nd">@lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="nb">max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">trigger_mask_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;&#39;defined in dB relative to the reference level&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_frequency_mask</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="nd">@trigger_mask_threshold</span>
    <span class="k">def</span> <span class="nf">trigger_mask_threshold</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_frequency_mask</span><span class="p">(</span><span class="n">first_threshold_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_frequency_mask</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">,</span> <span class="n">frequency_offsets</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the frequency-dependent trigger threshold values for a frequency mask trigger.</span>

<span class="sd">        :param thresholds: trigger threshold at each frequency in db relative to the reference level (same size as `frequency_offsets`), or a scalar to use a constant value across the band</span>
<span class="sd">        :param array-like frequency_offsets: frequencies at which the mask is defined, or None (to specify across the whole band)</span>
<span class="sd">        :param kind: either &#39;upper&#39; or &#39;lower,&#39; corresponding to a trigger on entering the upper trigger definition or on leaving the lower trigger definition</span>
<span class="sd">        :param window: The window number corresponding to the desired trigger setting (or self.default_window when window=None)</span>
<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>
        <span class="k">if</span> <span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;frequency mask is &quot;</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">&quot; but must be &quot;upper&quot; or &quot;lower&quot;&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">frequency_offsets</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">iq_bandwidth</span>
            <span class="n">frequency_offsets</span> <span class="o">=</span> <span class="o">-</span><span class="n">bw</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">bw</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">):</span>
                <span class="n">thresholds</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">frequency_offsets</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">thresholds</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">thresholds</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;with frequency_offsets=None, thresholds must be a scalar or have length 2&quot;</span>
                <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:MASK:CDIR &#39;.&#39;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:MASK:NAME &#39;</span><span class="si">{</span><span class="n">DEFAULT_CHANNEL_NAME</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">frequency_offsets</span><span class="p">,</span> <span class="n">thresholds</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">plist</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flat</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:MASK:</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">plist</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nd">@lb</span><span class="o">.</span><span class="n">datareturn</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">get_frequency_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">first_threshold_only</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the frequency-dependent trigger threshold values for a frequency mask trigger.</span>

<span class="sd">        :param kind: either &#39;upper&#39; or &#39;lower,&#39; corresponding to a trigger on entering the upper trigger definition or on leaving the lower trigger definition</span>
<span class="sd">        :param window: The window number corresponding to the desired trigger setting (or self.default_window when window=None)</span>
<span class="sd">        :param bool first_threshold_only: if True, return only the threshold; otherwise, return a complete parameter dict</span>
<span class="sd">        :return: the threshold or a dictionary with keys &quot;frequency_offsets&quot; and &quot;thresholds&quot; and corresponding values (in Hz and dBm, respectively) of equal length</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span>
        <span class="k">if</span> <span class="n">kind</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;upper&quot;</span><span class="p">,</span> <span class="s2">&quot;lower&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;frequency mask is &quot;</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s1">&quot; but must be &quot;upper&quot; or &quot;lower&quot;&#39;</span>
            <span class="p">)</span>

        <span class="n">plist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CALC</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2">:MASK:</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2">?&quot;</span><span class="p">)</span>
        <span class="n">plist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plist</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">first_threshold_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">plist</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;frequency_offsets&quot;</span><span class="p">:</span> <span class="n">plist</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;thresholds&quot;</span><span class="p">:</span> <span class="n">plist</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]}</span>

    <span class="k">def</span> <span class="nf">setup_spectrogram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">center_frequency</span><span class="p">,</span>
        <span class="n">analysis_bandwidth</span><span class="p">,</span>
        <span class="n">reference_level</span><span class="p">,</span>
        <span class="n">time_resolution</span><span class="p">,</span>
        <span class="n">acquisition_time</span><span class="p">,</span>
        <span class="n">input_attenuation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">trigger_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">detector</span><span class="o">=</span><span class="s2">&quot;SAMP&quot;</span><span class="p">,</span>
        <span class="n">analysis_window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Quick setup for a spectrogram measurement in RTSA mode.</span>

<span class="sd">        :param center_frequency: in Hz</span>
<span class="sd">        :param frequency_span: in Hz</span>
<span class="sd">        :param reference_level: in dBm</span>
<span class="sd">        :param time_resolution: in s</span>
<span class="sd">        :param acquisition_time: in s</span>
<span class="sd">        :param input_attenuation: in dB (or None to autoset based on the reference level)</span>
<span class="sd">        :param trigger_threshold: in dB (or None to free run)</span>
<span class="sd">        :param detector: &#39;SAMP&#39; or &#39;AVER&#39;</span>
<span class="sd">        :param analysis_window: one of [&#39;BLAC&#39;,&#39;FLAT&#39;,&#39;GAUS&#39;,&#39;HAMM&#39;,&#39;HANN&#39;,&#39;KAIS&#39;,&#39;RECT&#39;]</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">default_window</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_trace</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_cache</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="c1"># Work around an apparent SCPI bug by setting</span>
        <span class="c1"># frequency parameters in spectrum analyzer mode</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_channel_type</span><span class="p">(</span><span class="s2">&quot;SAN&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel_preset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_center</span> <span class="o">=</span> <span class="n">center_frequency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">10000</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_channel_type</span><span class="p">(</span><span class="s2">&quot;RTIM&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initiate_continuous</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frequency_span</span> <span class="o">=</span> <span class="n">analysis_bandwidth</span>

        <span class="c1"># Setup traces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove_window</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reference_level</span> <span class="o">=</span> <span class="n">reference_level</span>
        <span class="k">if</span> <span class="n">input_attenuation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">input_attenuation</span> <span class="o">=</span> <span class="n">input_attenuation</span>
            <span class="k">if</span> <span class="n">reference_level</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">30</span> <span class="ow">and</span> <span class="n">input_attenuation</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">input_preamplifier_enabled</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Trace acquisition parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_detector_type</span><span class="p">(</span><span class="n">detector</span><span class="p">)</span>

        <span class="c1"># Sweep parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sweep_time_window2</span> <span class="o">=</span> <span class="n">time_resolution</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_time_window2</span> <span class="o">!=</span> <span class="n">time_resolution</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;requested time resolution </span><span class="si">{</span><span class="n">time_resolution</span><span class="si">}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but instrument adjusted to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_time_window2</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spectrogram_depth</span> <span class="o">=</span> <span class="mi">100000</span>

        <span class="c1"># Triggering</span>
        <span class="k">if</span> <span class="n">trigger_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_source</span> <span class="o">=</span> <span class="s2">&quot;MASK&quot;</span>
            <span class="n">th</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">[</span><span class="n">trigger_threshold</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">[</span><span class="n">trigger_threshold</span><span class="p">]</span>
            <span class="n">rbw</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution_bandwidth</span>
            <span class="n">fr</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">analysis_bandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">rbw</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rbw</span><span class="p">,</span> <span class="n">analysis_bandwidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_frequency_mask</span><span class="p">(</span><span class="n">thresholds</span><span class="o">=</span><span class="n">th</span><span class="p">,</span> <span class="n">frequency_offsets</span><span class="o">=</span><span class="n">fr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_post_time</span> <span class="o">=</span> <span class="n">acquisition_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_pre_time</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_post_time</span> <span class="o">=</span> <span class="n">acquisition_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_dwell_auto</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_dwell_time</span> <span class="o">=</span> <span class="n">acquisition_time</span>

        <span class="c1"># TODO: Parameterize somehow</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_trigger2_direction</span> <span class="o">=</span> <span class="s2">&quot;OUTP&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_trigger2_type</span> <span class="o">=</span> <span class="s2">&quot;DEV&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_trigger3_direction</span> <span class="o">=</span> <span class="s2">&quot;OUTP&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_trigger3_type</span> <span class="o">=</span> <span class="s2">&quot;DEV&quot;</span>
        <span class="k">if</span> <span class="n">analysis_window</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sweep_window_type</span> <span class="o">=</span> <span class="s2">&quot;BLAC&quot;</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mi">2500</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_cache</span><span class="p">()</span>
        <span class="n">lb</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">spectrogram_depth</span>

    <span class="k">def</span> <span class="nf">acquire_spectrogram_sequence</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">loop_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delay_time</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="s2">&quot;fast&quot;</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger and fetch data, optionally in a loop that continues for a specified</span>
<span class="sd">        duration.</span>

<span class="sd">        :param loop_time: time (in s) to spend looping repeated trigger-fetch cycles, or None to execute once</span>
<span class="sd">        :param delay_time: delay time before starting (in s)</span>
<span class="sd">        :param timestamps: &#39;fast&#39; (with potential for rounding errors to ~ 10 ns) or &#39;exact&#39; (slow and not recommended)</span>
<span class="sd">        :return: dictionary structured as {&#39;spectrogram&#39;: pd.DataFrame, &#39;spectrogram_acquisition_time&#39;: float, &#39;spectrogram_active_time&#39;: float}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">specs</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;mask&quot;</span><span class="p">:</span>
            <span class="n">max_trigger_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_post_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_trigger_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_dwell_time</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">time_remaining</span> <span class="o">=</span> <span class="n">loop_time</span>
        <span class="n">active_time</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">while</span> <span class="n">loop_time</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">time_remaining</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Setup</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_spectrogram</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="c1"># Give the power sensor time to arm</span>
            <span class="n">lb</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay_time</span><span class="p">)</span>

            <span class="n">t0_active</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="c1"># Try to trigger; block until timeout.</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppress_timeout</span><span class="p">():</span>
                <span class="c1"># print(max(30*max_trigger_time,time_remaining or 0.1))</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">max_trigger_time</span><span class="p">)):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trigger_single</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">lb</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
                <span class="n">active_time</span> <span class="o">+=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0_active</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="mf">1e3</span> <span class="o">*</span> <span class="n">max_trigger_time</span>
                <span class="n">single</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_spectrogram</span><span class="p">(</span>
                    <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span><span class="p">,</span> <span class="n">timestamps</span><span class="o">=</span><span class="n">timestamps</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">backend</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="k">if</span> <span class="n">single</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">specs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">single</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abort</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">loop_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time_remaining</span> <span class="o">=</span> <span class="n">loop_time</span> <span class="o">-</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">specs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">specs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">specs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">specs</span> <span class="k">else</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">specs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;no data acquired&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;spectrogram_data&quot;</span><span class="p">:</span> <span class="n">specs</span><span class="p">,</span>
            <span class="s2">&quot;spectrogram_acquisition_time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">,</span>
            <span class="s2">&quot;spectrogram_active_time&quot;</span><span class="p">:</span> <span class="n">active_time</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">arm_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_spectrogram</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">acquire_spectrogram</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger and acquire data, optionally in a loop that continues for a specified</span>
<span class="sd">        duration.</span>

<span class="sd">        :return: dictionary structured as {&#39;spectrogram_active_time&#39;: float}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;mask&quot;</span><span class="p">:</span>
            <span class="n">max_trigger_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trigger_post_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">max_trigger_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_dwell_time</span>

        <span class="c1"># Try to trigger; block until timeout.</span>
        <span class="c1"># print(max(30*max_trigger_time,time_remaining or 0.1))</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlap_and_block</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mf">1e3</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="n">max_trigger_time</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trigger_single</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;spectrogram_active_time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">}</span>


<div class="viewcode-block" id="RohdeSchwarzFSW26Base"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW26Base">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW26Base</span><span class="p">(</span><span class="n">RohdeSchwarzFSWBase</span><span class="p">):</span>
    <span class="n">frequency_center</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:CENT&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">26.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>
    <span class="n">frequency_span</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:SPAN&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">26.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>
    <span class="n">frequency_start</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:START&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">26.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>
    <span class="n">frequency_stop</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:STOP&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">26.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>

    <span class="n">resolution_bandwidth</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;BAND&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">45e3</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">5.76e6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW26SpectrumAnalyzer"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW26SpectrumAnalyzer">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW26SpectrumAnalyzer</span><span class="p">(</span>
    <span class="n">RohdeSchwarzFSW26Base</span><span class="p">,</span> <span class="n">RohdeSchwarzSpectrumAnalyzerMixIn</span>
<span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW26LTEAnalyzer"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW26LTEAnalyzer">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW26LTEAnalyzer</span><span class="p">(</span><span class="n">RohdeSchwarzFSW26Base</span><span class="p">,</span> <span class="n">RohdeSchwarzLTEAnalyzerMixIn</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW26IQAnalyzer"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW26IQAnalyzer">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW26IQAnalyzer</span><span class="p">(</span><span class="n">RohdeSchwarzFSW26Base</span><span class="p">,</span> <span class="n">RohdeSchwarzIQAnalyzerMixIn</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW26RealTime"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW26RealTime">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW26RealTime</span><span class="p">(</span><span class="n">RohdeSchwarzFSW26Base</span><span class="p">,</span> <span class="n">RohdeSchwarzRealTimeMixIn</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW43Base"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW43Base">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW43Base</span><span class="p">(</span><span class="n">RohdeSchwarzFSWBase</span><span class="p">):</span>
    <span class="n">frequency_center</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:CENT&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">43.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>
    <span class="n">frequency_span</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:SPAN&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">43.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>
    <span class="n">frequency_start</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:START&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">43.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>
    <span class="n">frequency_stop</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span>
        <span class="n">key</span><span class="o">=</span><span class="s2">&quot;FREQ:STOP&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">43.5e9</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1e-9</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span>
    <span class="p">)</span>

    <span class="n">resolution_bandwidth</span> <span class="o">=</span> <span class="n">lb</span><span class="o">.</span><span class="n">property</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s2">&quot;BAND&quot;</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">10e6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW43SpectrumAnalyzer"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW43SpectrumAnalyzer">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW43SpectrumAnalyzer</span><span class="p">(</span>
    <span class="n">RohdeSchwarzFSW43Base</span><span class="p">,</span> <span class="n">RohdeSchwarzSpectrumAnalyzerMixIn</span>
<span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW43LTEAnalyzer"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW43LTEAnalyzer">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW43LTEAnalyzer</span><span class="p">(</span><span class="n">RohdeSchwarzFSW43Base</span><span class="p">,</span> <span class="n">RohdeSchwarzLTEAnalyzerMixIn</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW43IQAnalyzer"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW43IQAnalyzer">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW43IQAnalyzer</span><span class="p">(</span><span class="n">RohdeSchwarzFSW43Base</span><span class="p">,</span> <span class="n">RohdeSchwarzIQAnalyzerMixIn</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="RohdeSchwarzFSW43RealTime"><a class="viewcode-back" href="../../../autoapi/ssmdevices/instruments/signal_analyzers/index.html#ssmdevices.instruments.RohdeSchwarzFSW43RealTime">[docs]</a><span class="k">class</span> <span class="nc">RohdeSchwarzFSW43RealTime</span><span class="p">(</span><span class="n">RohdeSchwarzFSW43Base</span><span class="p">,</span> <span class="n">RohdeSchwarzRealTimeMixIn</span><span class="p">):</span>
    <span class="k">pass</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../ssmdevices.html">ssmdevices v0.11</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">ssmdevices.instruments.signal_analyzers</a></li> 
      </ul>
    </div>
<hr \>
<section class="footer">
<br><a target="_blank" href="http://www.nist.gov/public_affairs/privacy.cfm#privpolicy">Privacy Policy</a> | <a target="_blank" href="http://www.nist.gov/public_affairs/privacy.cfm#secnot">Security Notice</a> | <a href="http://www.nist.gov/public_affairs/privacy.cfm#accesstate">Accessibility Statement</a>
<br><em>United States government work, not subject to copyright in the United States</em>
</section>

  </body>
</html>